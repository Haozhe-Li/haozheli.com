<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>相似性检测器</title>
  <link rel="stylesheet" href="css/style.css">

  <script>
    // JavaScript code goes here
    // ...

    // Preprocess the text: tokenize and convert to lowercase
  function preprocessText(rawText) {
      let tokens = [];
      let token = "";
      for (let i = 0; i < rawText.length; i++) {
      let c = rawText[i];
      if (/[a-zA-Z0-9]/.test(c)) {
          token += c.toLowerCase();
      } else if (token !== "") {
          tokens.push(token);
          token = "";
      }
      }
      if (token !== "") {
      tokens.push(token);
      }
      return tokens;
  }
  
  // Create windows from the processed text
  function createWindows(processedText, windowSize) {
    let windows = [];
    for (let i = 0; i <= processedText.length - windowSize; i++) {
        let window = "";
        for (let j = i; j < i + windowSize; j++) {
            window += processedText[j];
            // Only add a space if it's not the last word in the window
            if (j < i + windowSize - 1) {
                window += " ";
            }
        }
        windows.push(window);
    }
    return windows;
  }

  // Hash the windows using a simple hash function (you should replace this with a better hash function)
  function hashWindows(windows) {
    let hashes = [];
    for (let i = 0; i < windows.length; i++) {
        let hash = 0;
        for (let j = 0; j < windows[i].length; j++) {
            let c = windows[i].charCodeAt(j);
            hash = 31 * hash + c;
        }
        hashes.push(hash);
    }
    return hashes;
  }

  
  // Get the fingerprints from the hashes
  function getFingerprints(hashes) {
      let fingerprints = new Set();
      for (let i = 0; i < hashes.length; i++) {
      fingerprints.add(hashes[i]);
      }
      return fingerprints;
  }

    // Detect plagiarism by comparing the fingerprints
function detectPlagiarism(fingerprints1, fingerprints2) {
const counter = 0;
for (let fingerprint of fingerprints1) {
if (fingerprints2.has(fingerprint)) {
    return true;
}
}
return false;
}

  function runPlagiarismDetection() {
    // Get the input text from the textboxes
    let text1 = document.getElementById("text1").value;
    let text2 = document.getElementById("text2").value;
    //document.getElementById("size1").innerText = text1.length;
    //document.getElementById("size2").innerText = text2.length;

    // Preprocess the texts
    let processedText1 = preprocessText(text1);
    let processedText2 = preprocessText(text2);

    let windowSize = text1.length < text2.length ? Math.floor(text1.length / 50) : Math.floor(text2.length / 50);
    if (windowSize < 1) {
      windowSize = 1;
    }
    if (windowSize > 100) {
      windowSize = 100;
    }

    document.getElementById("windowsize").innerText = windowSize;

    // Create windows
    let windows1 = createWindows(processedText1, windowSize);
    let windows2 = createWindows(processedText2, windowSize);

    // Hash the windows
    let hashes1 = hashWindows(windows1);
    let hashes2 = hashWindows(windows2);

    // Get the fingerprints
    let fingerprints1 = getFingerprints(hashes1);
    let fingerprints2 = getFingerprints(hashes2);
    const fg1 = JSON.stringify([...fingerprints1]).substring(0, 40);
    const fg2 = JSON.stringify([...fingerprints1]).substring(0, 40);
    document.getElementById("fg1").innerText = fg1;
    document.getElementById("fg2").innerText = fg2;

    // Detect plagiarism
    let isPlagiarized = detectPlagiarism(fingerprints1, fingerprints2);

// Display the result
    document.getElementById("result").innerText = isPlagiarized ? "High" : "Low";
  }
  
  </script>
</head>

<body>
  <!-- contact -->
  <section class="w3l-contact-5">
    <div class="contact-top section-gap">
      <div class="wrapper">
        <div class="d-grid cont-main-top">
          <!-- contact form -->
          <div class="contacts12-main">
            <h3 class="title-main-cont">相似性检测器</h3>
            <p class="sub-title-cont">这是一款基于 WINNOWING 算法的简单文本相似性检测器。检测过程通过 JavaScript 在前端进行。本网站不存储任何记录或数据。请随意使用！</p>
            中文 | <a href="index.html">English</a>
            <textarea id="text1" rows="10" cols="200" placeholder="在此输入您的第一个文本"></textarea>
            <textarea id="text2" rows="10" cols="200" placeholder="在此输入您的第二个文本"></textarea>

            <div class="text-right">
              <button onclick="runPlagiarismDetection()" class="btn btn-contact">开始检测</button>
            </div>
          </div>
          <!-- //contact form -->
          <!-- contact address -->
          <div class="contact">
            <div class="cont-subs">
              <div class="cont-add">
                <h4>相似性</h4>
                <p id="result">两个文本之间的相似度。这将产生两种结果：高或低。</p>
              </div>
              <div class="cont-add">
                <h4>窗口大小：</h4>
                <p id="windowsize">用于检测的窗口大小：会是一个1到100以内的数字。</p>
              </div>
              <div class="cont-add">
                <h4>文本指纹 1：</h4>
                <p id="fg1">第一个文本的指纹预览：会是一个哈希值列表。</p>
              </div>
              <div class="cont-add">
                <h4>文本指纹 2：</h4>
                <p id="fg2">第二个文本的指纹预览：会是一个哈希值列表。</p>
              </div>
              <a href="https://www.haozheli.com" target="_blank">Copyright Haozhe Li 2023</a>
            </div>
          </div>
          <!-- //contact address -->
        </div>
      </div>
      <!-- map -->
      <!-- //map -->
    </div>
  </section>
  <!-- //contact -->
</body>

</html>